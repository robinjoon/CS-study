# 쿠키와 세션

## 📁 쿠키와 세션을 사용하는 이유

HTTP 프로토콜의 특징이자 약점을 보완하기 위해서 사용된다.

1.  Connectionless 프로토콜 (비연결지향)
    클라이언트가 서버에 요청(Request)을 했을 때,
    그 요청에 맞는 응답(Response)을 보낸 후 연결을 끊는 처리방식이다. - HTTP 1.1 버전에서 연결을 유지하고, 재활용 하는 기능이 Default 로 추가되었다.
    (keep-alive 값으로 변경 가능)

2.  Stateless 프로토콜 (상태정보 유지 안함)
    클라이언트의 상태 정보를 가지지 않는 서버 처리 방식이다.
    클라이언트와 첫번째 통신에서 데이터를 주고 받았다 해도,
    두번째 통신에서 이전 데이터를 유지하지 않는다.

    👉 정보가 유지되지 않으면, 매번 페이지를 이동할 때마다 불편함이 발생하여 이를 대처하기 위해 쿠키는 '클라이언트(=로컬PC)'에 저장하고, 세션은 '서버' 에 저장한다.

## 📁 쿠키

- 쿠키는 웹 사이트에 접속할 때 생성되는 정보를 담은 임시 파일

- 쿠키는 서버가 사용자의 웹 브라우저에 저장하는 데이터를 말합니다.

- 쿠키의 데이터 형태는 Key 와 Value로 구성되고 String 형태로 이루어져 있습니다.

<br/>
📌 쿠키의 사용목적

쿠키는 주로 아래의 세 가지 목적을 위해 사용됩니다.

1. `세션 관리(Session Management)` 로그인, 사용자 닉네임, 접속 시간, 장바구니 등의 서버가 알아야할 정보들을 저장합니다.

2. `개인화(Personalization)` 사용자마다 다르게 그 사람에 적절한 페이지를 보여줄 수 있습니다.

3. `트래킹(Tracking)` 사용자의 행동과 패턴을 분석하고 기록합니다.

<br/>
📌 쿠키가 사용되는 예시

- 쿠키가 있기 때문에 여러 페이지를 이동할 때마다 로그인을 하지 않고 사용자 정보를 유지할 수 있는 것입니다.

- 쿠키가 없다면 다음 페이지로 정보를 파라미터로 넘겨줘야 합니다.

- ID 저장, 로그인 상태 유지
- 일주일간 다시 보지 않기.
- 최근 검색한 상품들을 광고에서 추천
- 쇼핑몰 장바구니 기능

<br/>
📌 쿠키의 단점

1. 방문했던 웹 사이트에 대한 정보 및 개인정보가 기록되기 때문에 사생활을 침해할 소지가 있으며, 이를 해소하기 위해서 웹 브라우저 자체에 쿠키 거부 기능이 있습니다. 이러한 쿠키에 대한 거부가 웹 브라우저에 설정되어 있으면, 쿠키 본래의 목적인 웹 브라우저와의 연결을 지속시키는 기능을 수행할 수 없는 경우가 발생합니다.

2. 서버가 가지고 있는 것이 아니라 사용자에게 저장되기 때문에, 임의로 고치거나 지울 수 있고, 가로채기도 쉬워 보안이 취약합니다. 따라서 , 쿠키에는 민감하거나 중요한 정보를 담는 것은 위험합니다.

<br/>

## 📁 세션

- 세션 아이디는 웹 브라우저 당 1개씩 생성되어 웹 컨테이너에 저장되며 브라우저 종료시 소멸됩니다.

- 로그인한 사용자에 대해서만 세션을 생성하는 것이 아니라

- 로그아웃하면 새로운 사용자로 인식해서 새로운 세션이 생성됩니다.

  (참고로 쿠키는 내 웹브라우저에 저장된 것이기 때문에 로그아웃 유무와 관계없이 삭제하지 않으면 유지됩니다.)

- 아이디, 닉네임 등의 정보를 세션에 담아두면 요청이 있을 때 마다, DB에 접근할 필요가 없어서 효율적입니다.

- `저장형식` Object

<br/>
📌 세션의 단점 
 
 - 세션은 서버에 저장되고 서버의 메모리로 로딩이 되기 때문에 세션이 생길때마다 서버의 리소스를 차지

- 쿠키보다 느리다.

<br/>
📌 세션 동작 방식

1. 클라이언트가 서버에 접속 시 세션 ID를 발급 받음
2. 클라이언트는 세션 ID에 대해 `쿠키를 사용해서` 저장하고 가지고 있음
3. 클라리언트는 서버에 요청할 때, 이 쿠키의 세션 ID를 같이 서버에 전달해서 요청
4. 서버는 세션 ID를 전달 받아서 별다른 작업없이 세션 ID로 세션에 있는 클라언트 정보를 가져와서 사용
5. 클라이언트 정보를 가지고 서버 요청을 처리하여 클라이언트에게 응답

<br/>

## 📁 세션을 쓰면되는데 굳이 쿠키를 사용하는 이유?

세션이 쿠키에 비해 보안도 높은 편이나 쿠키를 사용하는 이유는
세션은 서버에 저장되고, 서버자원을 사용하기 때문에 사용자가 많을 경우 소모되는 자원이 상당하다.

이러한 자원관리 차원에서 쿠키와 세션을 적절한 요소 및 기능에 병행 사용하여,
서버 자원의 낭비를 방지하며 웹사이트의 속도를 높일 수 있다.

<br/>

## 📁 웹 스토리지

웹 스토리지는 서버가 아닌, 클라이언트에 데이터를 저장할 수 있도록 지원하는 HTML5의 새로운 기능입니다.

쿠키와 기능 자체는 유사하지만 4KB 밖에 저장하지 못하는 쿠키와 다르게 웹 스토리지는 약 5MB 까지 저장공간을 이용할 수 있습니다. 웹 스토리지의 최신 스펙은 https://www.w3.org/TR/webstorage/ 에서 확인할 수 있습니다.

웹 스토리지에는 `로컬 스토리지(local Storage)` 와` 세션 스토리지(session Storage)` 가 있습니다. 로컬 스토리지와 세션 스토리지는 각각의 고유한 특성이 있으며, 프로그래머의 필요에 따라 선택적으로 사용됩니다. 다음 항목에서는 로컬 스토리지와 세션 스토리지에 대한 각각의 특성에 대해 설명합니다.

<br/>
📌 로컬 스토리지
로컬 스토리지는 브라우저 자체에 반영구적으로 데이터를 저장하며, 브라우저를 종료해도 데이터가 유지됩니다. 다만 도메인(domain)이 다른 경우 로컬 스토리지에 접근할 수 없습니다. 예를 들어 naver.com 로컬 스토리지에서 저장한 데이터는 google.com 에서 접근할 수 없는 것과 같습니다.

<br/>
📌 세션 스토리지
세션 스토리지는 각 세션마다 데이터가 개별적으로 저장되며 로컬 스토리지와 다르게 세션을 종료하면 데이터가 자동으로 제거되며 같은 도메인이라도 세션이 다르면 데이터에 접근할 수 없습니다.
